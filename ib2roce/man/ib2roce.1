.\" Licensed under the OpenIB.org BSD license (FreeBSD Variant) - See COPYING.md
.\"
.\" Copyright (C) 2022 Christoph Lameter <cl@linux.com>
.\"
.TH "ib2roce" 1 "2022-10-28" "ib2roce" "ib2roce" ib2roce
.SH NAME
ib2roce \- Infiniband to ROCE gateway
.SH SYNOPSIS
.sp
.nf
\fIib2roce\fR [<options>] [-d <infiniband device] [-r <roce device>] [-m <multicast address>] .. 
.fi
.SH "DESCRIPTION"
ib2roce is a bridging tool that monitors and forwards RDMA packets
between an Infiniband fabric and a Ethernet fabric. On the Ethernet
side ROCE v2 is used for RDMA communication.

ib2roce currently only supports multicast operations in its standard
deployment. There is an experimental unicast mode however, that is
not well tested. ib2roce forwards messsagess and does not do true
RDMA read and write operations. True RDMA operations are not considered
necessary since the primary role of ib2roce is to support multicast
messaging on RDMA fabrics that need unicast only as a recovery
control channel. ib2roce is optimized to provide the highest
throughput for multicast messaging an can be configured for
low latency on NOHZ_FULL cores.
.SH "OPTIONS"
.TP
\-d, --device  <infiniband-device[:port]>
Specifies the Infiniband device to use with an optional port number.
The port defaults to one if not specified.

ib2roce will scan all devices on startup and will use the first
Infiniband device that is suitable by default. If there are
multiple Infiniband fabric attached then this option is necessary
to identify the one to use.
.TP
\-i, --inbound <ipv4 multicast address[:port][/<mgid-format]
A multicast address that should be forwarded from Infiniband
to ROCE. Traffic in the other direction is ignored.
.TP
\-l, --mgid [<format>]
Specifies which MGID format to use on Infiniband. There are a
couple of standards on how to encode ipv4 addresses in the
MGID on Infiniband. This selects
the method to use and its use is depending on the type of traffic
that needs to be forwarded between the fabrics. Note that -l
only affects the multicast groups specified on the command line
after the option was specified.

If no format is specified then ib2roce will display the available
formats. If no custom mgid format is set for a multicast group
(the default) then ib2roce will perform a join using CLLM conventions
on Infiniband.

The CLLM MGID format relies on the use of a port number to construct
the MGID. This means that the port number needs to be correctly
configured otherwise the MGID will not match and traffic will not
flow to and from CLLM based applications. Other MGID encoding
schemes do not include the port and there is also no way to specify
an effective port for UDP datagrams on ROCE.
.TP
\-m, --multicast <ipv4 multicast address[:port][/<mgid-format]>
Specify a multicast address that should be forwarded in both directions.
The port specification is optional since it is often not relevant for multicast
traffic forwarding. The mgid format can be specified to override
the global setting. See the -l option for more details.
.TP
\-n, --nobridge
Run ib2roce without actually forwarding any packets. This is useful
for debugging since the packet statistics and ib2roce logs will
show useful information about multicast groups and the amount
of traffic that may have to be forwarded.
.TP
\-o, --outbound <ipv4 multicast address[:port][/<mgid-format]
A multicast address that should be forwarded from ROCE
to Infiniband. Traffic in the other direction is ignored. Sendonly joins
occur to avoid additional traffic on the fabric.
.TP
\-p, --port <number>
Set the default port number. This is used when binding to ROCE and Infiniband
devices and for multicast groups that do not have a port specified.
Currently these port numbers seem to be ignored by the RDMA subsystem.
However, the port number is relevant when an CLLM MGID needs to be
constructed.
.TP
\-r, --roce  <roce-device[:port]>
Specifies the ROCE Ethernet device to use with an optional port number.
The port defaults to one if not specified.

ib2roce will scan all devices on startup and will use the first
Ethernet device that supports ROCE v2 and IPv4 by default. If there are
multiple ROCE fabrics attached then this option may be necessary
to specify which one to use.
.TP
\-x, --debug
Switches ib2roce into debug mode. ib2roce does not daemonize but
keeps logging diagnostic output to stderr.
.TP
\-s, --systemd
Run ib2roce from systemd. Do not create a pid file and use the systemd libraries
for logging and process state notifications.
.SH "NOTES"
ib2roce creates files in either the current directory or in /var/lib/ib2roce. These
are the ib2roce.pid file to be able to detect the presence of an already running
ib2roce instance and the ib2roce-status file that is updated in regular
intervals with ib2roce information.
.SH "SEE ALSO"
roce2ib(7)
.SH AUTHORS
Christoph Lameter <cl@linux.com>
